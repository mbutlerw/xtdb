[:project
 [{s_name s.1/s_name} {s_address s.1/s_address}]
 [:order-by
  [[s.1/s_name {:direction :asc, :null-ordering :nulls-last}]]
  [:project
   [s.1/s_name s.1/s_address]
   [:map
    [{xt$sq_0 true}]
    [:mega-join
     [{s.1/s_nationkey n.2/n_nationkey}]
     [[:semi-join
       [{s.1/s_suppkey ps_suppkey}]
       [:rename
        s.1
        [:scan
         {:table supplier}
         [s_name s_address s_nationkey s_suppkey]]]
       [:project
        [{ps_suppkey ps.3/ps_suppkey}]
        [:select
         (> ps.3/ps_availqty xt$sq_1)
         [:map
          [{xt$sq_1 (* 0.5 xt$sum_out_8)}]
          [:group-by
           [ps.3/ps_partkey
            ps.3/ps_availqty
            ps.3/ps_suppkey
            xt$sq_0
            xt$row_number_0
            {xt$sum_out_8 (sum l.5/l_quantity)}]
           [:left-outer-join
            [{ps.3/ps_partkey l.5/l_partkey}
             {ps.3/ps_suppkey l.5/l_suppkey}]
            [:map
             [{xt$row_number_0 (row-number)}]
             [:map
              [{xt$sq_0 true}]
              [:semi-join
               [{ps.3/ps_partkey p_partkey}]
               [:rename
                ps.3
                [:scan
                 {:table partsupp}
                 [ps_partkey ps_availqty ps_suppkey]]]
               [:project
                [{p_partkey p.4/p_partkey}]
                [:rename
                 p.4
                 [:scan
                  {:table part}
                  [p_partkey {p_name (like p_name "forest%")}]]]]]]]
            [:rename
             l.5
             [:scan
              {:table lineitem}
              [l_partkey
               {l_shipdate
                (and
                 (<
                  l_shipdate
                  (+
                   #time/date "1994-01-01"
                   (single-field-interval "1" "YEAR" 2 6)))
                 (>= l_shipdate #time/date "1994-01-01"))}
               l_quantity
               l_suppkey]]]]]]]]]
      [:rename
       n.2
       [:scan
        {:table nation}
        [n_nationkey {n_name (= n_name "CANADA")}]]]]]]]]]
