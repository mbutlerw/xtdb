[:project
 [{cntrycode custsale.8/cntrycode} numcust totacctbal]
 [:order-by
  [[custsale.8/cntrycode
    {:direction :asc, :null-ordering :nulls-last}]]
  [:project
   [custsale.8/cntrycode
    {numcust xt$row_count_9}
    {totacctbal xt$sum_out_10}]
   [:group-by
    [custsale.8/cntrycode
     {xt$sum_out_10 (sum custsale.8/c_acctbal)}
     {xt$row_count_9 (row-count)}]
    [:rename
     custsale.8
     [:project
      [{cntrycode (substring c.1/c_phone 1 2)}
       {c_acctbal c.1/c_acctbal}]
      [:select
       (> c.1/c_acctbal xt$sq_1)
       [:single-join
        []
        [:map
         [{xt$sq_2 true}]
         [:map
          [{xt$sq_0 true}]
          [:anti-join
           [{c.1/c_custkey o_custkey}]
           [:semi-join
            [{xt$needle xt.values.2/xt$column_1}]
            [:map
             [{xt$needle (substring c.1/c_phone 1 2)}]
             [:rename
              c.1
              [:scan {:table customer} [c_phone c_custkey c_acctbal]]]]
            [:rename
             xt.values.2
             [:table
              [xt$column_1]
              [{:xt$column_1 "13"}
               {:xt$column_1 "31"}
               {:xt$column_1 "23"}
               {:xt$column_1 "29"}
               {:xt$column_1 "30"}
               {:xt$column_1 "18"}
               {:xt$column_1 "17"}]]]]
           [:project
            [{o_clerk o.6/o_clerk}
             {o_comment o.6/o_comment}
             {o_custkey o.6/o_custkey}
             {o_orderdate o.6/o_orderdate}
             {o_orderkey o.6/o_orderkey}
             {o_orderpriority o.6/o_orderpriority}
             {o_orderstatus o.6/o_orderstatus}
             {o_shippriority o.6/o_shippriority}
             {o_totalprice o.6/o_totalprice}]
            [:rename
             o.6
             [:scan
              {:table orders}
              [o_custkey
               o_shippriority
               o_orderdate
               o_orderstatus
               o_orderkey
               o_clerk
               o_orderpriority
               o_totalprice
               o_comment]]]]]]]
        [:project
         [{xt$sq_1 xt$avg_out_5}]
         [:group-by
          [{xt$avg_out_5 (avg c.3/c_acctbal)}]
          [:map
           [{xt$sq_0 true}]
           [:semi-join
            [{xt$needle xt.values.4/xt$column_1}]
            [:map
             [{xt$needle (substring c.3/c_phone 1 2)}]
             [:rename
              c.3
              [:scan
               {:table customer}
               [c_phone {c_acctbal (> c_acctbal 0.0)}]]]]
            [:rename
             xt.values.4
             [:table
              [xt$column_1]
              [{:xt$column_1 "13"}
               {:xt$column_1 "31"}
               {:xt$column_1 "23"}
               {:xt$column_1 "29"}
               {:xt$column_1 "30"}
               {:xt$column_1 "18"}
               {:xt$column_1 "17"}]]]]]]]]]]]]]]]
