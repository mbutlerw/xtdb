[:project
 [{name s.1/name} {course e.2/course}]
 [:select
  (>= e.2/grade xt$sq_0)
  [:map
   [{xt$sq_0 (+ xt$avg_out_7 1)}]
   [:group-by
    [s.1/name
     s.1/major
     s.1/year
     s.1/id
     e.2/sid
     e.2/course
     e.2/grade
     xt$row_number_0
     {xt$avg_out_7 (avg e2.3/grade)}]
    [:left-outer-join
     [(or
       (= s.1/id e2.3/sid)
       (and (= e2.3/curriculum s.1/major) (> s.1/year e2.3/date)))]
     [:map
      [{xt$row_number_0 (row-number)}]
      [:mega-join
       [{s.1/id e.2/sid}]
       [[:rename
         s.1
         [:scan
          {:table students}
          [name
           {major (or (= major "CS") (= major "Games Eng"))}
           year
           id]]]
        [:rename e.2 [:scan {:table exams} [sid course grade]]]]]]
     [:rename
      e2.3
      [:scan {:table exams} [sid grade date curriculum]]]]]]]]
